<div class="expenses-container">

  <p *ngIf="loading" class="text-center">Loading...</p>

  <!-- Expenses List -->
  <div *ngIf="!loading && expenses.length">

    <div
      class="card mb-2"
      *ngFor="let expense of expenses"
    >
      <div class="card-body d-flex justify-content-between">
        <strong>{{ expense.title }}</strong>
        <span>{{ expense.amount }}</span>
      </div>
    </div>

  </div>

  <p *ngIf="!loading && !expenses.length" class="text-muted text-center">
    No expenses this month
  </p>

  <hr />

  <!-- Total -->
  <div class="invoice-total d-flex justify-content-between align-items-center mb-3 px-1">
    <span class="fw-bold">Total Expenses</span>
    <span class="fw-bold text-success fs-5">
      {{ totalAmount }} EGP
    </span>
  </div>

  <hr />

  <!-- Add Expense Button -->
  <button
    *ngIf="!showForm"
    class="btn button w-100"
    (click)="toggleForm()"
  >
    Add Expense
  </button>

  <!-- ======================
       Add Expense Form
  ======================= -->
  <form
    *ngIf="showForm"
    [formGroup]="expenseForm"
    (ngSubmit)="submit()"
    class="mt-3"
  >

    <!-- Title -->
    <div class="mb-2">
      <label>Title</label>
      <input
        type="text"
        class="form-control"
        formControlName="title"
      />

      <small
        class="text-danger"
        *ngIf="
          expenseForm.get('title')?.invalid &&
          expenseForm.get('title')?.touched
        "
      >
        Title is required
      </small>
    </div>

    <!-- Amount -->
    <div class="mb-2">
      <label>Amount</label>
      <input
        type="number"
        class="form-control"
        formControlName="amount"
      />

      <small
        class="text-danger"
        *ngIf="
          expenseForm.get('amount')?.errors?.['required'] &&
          expenseForm.get('amount')?.touched
        "
      >
        Amount is required
      </small>

      <small
        class="text-danger"
        *ngIf="
          expenseForm.get('amount')?.errors?.['min'] &&
          expenseForm.get('amount')?.touched
        "
      >
        Amount must be greater than 0
      </small>
    </div>

    <!-- Date -->
    <div class="mb-3">
      <label>Expense Date</label>
      <input
        type="date"
        class="form-control"
        formControlName="expenseDate"
      />

      <small
        class="text-danger"
        *ngIf="
          expenseForm.get('expenseDate')?.invalid &&
          expenseForm.get('expenseDate')?.touched
        "
      >
        Expense date is required
      </small>
    </div>

    <!-- ðŸ”´ General warning -->
    <div
      *ngIf="
        expenseForm.invalid &&
        (expenseForm.touched || expenseForm.dirty)
      "
      class="alert alert-danger py-2 text-center"
    >
      Please complete all required data
    </div>

    <!-- ðŸ”´ Backend error -->
    <div *ngIf="submitError" class="alert alert-danger py-2 text-center">
      {{ submitError }}
    </div>

    <!-- Actions -->
    <div class="d-flex gap-2">
      <button
        type="submit"
        class="btn button w-100"
        [disabled]="submitLoading"
      >
        {{ submitLoading ? 'Saving...' : 'Add' }}
      </button>

      <button
        type="button"
        class="btn btn-danger w-100"
        (click)="toggleForm()"
      >
        Cancel
      </button>
    </div>

  </form>

</div>
